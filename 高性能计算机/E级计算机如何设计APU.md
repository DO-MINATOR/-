### 应用分类

![image-20201230114738913](https://imagebag.oss-cn-chengdu.aliyuncs.com/img/image-20201230114738913.png)

- 计算密集型

性能受制于更高的CU频率和数量，同一内存带宽下，增加CU数量和频率能够提升总体性能，不同带宽对应的性能峰值一致，说明该类应用不受内存带宽影响。

![image-20201230115102496](https://imagebag.oss-cn-chengdu.aliyuncs.com/img/image-20201230115102496.png)

- 计算-访存均衡型

![image-20201230115627384](https://imagebag.oss-cn-chengdu.aliyuncs.com/img/image-20201230115627384.png)

![image-20201230115939583](https://imagebag.oss-cn-chengdu.aliyuncs.com/img/image-20201230115939583.png)

CU和内存性能指标同时提升有助于提升应用总体性能，内存带宽提升，应用基线性能提升，同一带宽下，提升CU指标，也能提升应用总体性能，但达到一定阈值时比例时，性能提升区域缓和，之后甚至有所下降。

- 访存密集型

![image-20201230120040727](https://imagebag.oss-cn-chengdu.aliyuncs.com/img/image-20201230120040727.png)

![image-20201230120052455](https://imagebag.oss-cn-chengdu.aliyuncs.com/img/image-20201230120052455.png)

CU指标的提升作用不明显，内存带宽成为主要瓶颈，若一味增加CU指标，则会由于破坏缓存、总线争用导致应用总体性能下降。

#### 说明不同应用的瓶颈所在，以及提升总体性能的大致方向。

### 不同应用片内与片外流量的对比

通常，计算密集型流量集中在片内，访存密集型流量集中在片外，缓存缺失所导致的应用性能下降对该类应用影响显著。

![image-20201230141542219](https://imagebag.oss-cn-chengdu.aliyuncs.com/img/image-20201230141542219.png)

MaxFlops这类应用，由于内核高度的计算并行性，且对缓存有效的控制，使得访存集中在片上DRAM上，只有个别从片外读取的流量被分散到几个周期，因此该类应用可以组织在较大的网络规模上。而对像SNAP这类访存密集型应用，片内miss的cache越多，片外的流量就越多，因此就要考虑提升片上DRAM容量和频率，且不适合在网络规模较大的机器上运行。除了改善应用程序的访存行为，一些优化手段也能减少这类程序对带宽时延的敏感。

### 访存能耗测试

片外基于NVM的大容量存储模型解决了E级计算机的容量问题，且用于存储数据时产生的静态功耗低，但缺点是读写访问数据时产生的动态功耗较高，该实验对比了片外两种存储架构（完全基于DRAM和DRAM+NVM）在不同应用场景下的功耗对比。

![image-20201230145446086](https://imagebag.oss-cn-chengdu.aliyuncs.com/img/image-20201230145446086.png)

对于CoMD、CoMD-LJ、MaxFlops这些计算密集型应用，由于对片外流量较低，此时系统总功耗较低，得益于NVM的静态低功耗，此时混合DRAM和NVM的存储架构优于纯DRAM。而其他应用，由于有较大的片外流量，因此受制于NVM的动态高功耗，系统总体功耗有明显增加，此时配置外部存储时，就需要综合功耗和容量需求两方面做权衡，选择合适的配置参数。

### 优化技术

在不牺牲程序性能的前提下，通过优化技术，降低整机功耗，平衡系统负载率。

- 片内异步交换：同步计算设计简单，但由于其高频的传输活动和时钟树的复杂性，使其动态功耗较高，而将时延不敏感的部分异步化，使得平均系统功耗节省4.3%。
- 片外异步路由：节省3%的功耗。
- 低功耗链路：节省1.6%的功耗。
- 片间流量压缩：对片间传输的网络数据进行压缩，可降低网络传输延迟，同时减少片外动态存取功耗。平均节省功率1.7%。

![image-20201230153417425](https://imagebag.oss-cn-chengdu.aliyuncs.com/img/image-20201230153417425.png)

不同应用对不同技术收益的效果不同，如LULESH访存密集型应用从片间流量压缩中受益明显。而片内异步交换技术对MaxFlops计算密集型应用产生的收益最大。

![image-20201230153921288](https://imagebag.oss-cn-chengdu.aliyuncs.com/img/image-20201230153921288.png)

该图是各类应用在采用优化技术后，单位瓦特所提升的性能比。通过这些优化手段，使得系统产生性能剩余，这部分空间可以采用提升CU个数/频率以补充，形成优势互补。例如在采用低功耗链路和流量压缩技术后，片间传输瓶颈问题得以缓解，这时，可继续提升CU单元个数或计算频率，如图是在不超过20MW功耗的限制下，提升CU个数所得到的整机计算峰值。最终可达到1.86E级别的计算。

![image-20201230155434610](https://imagebag.oss-cn-chengdu.aliyuncs.com/img/image-20201230155434610.png)